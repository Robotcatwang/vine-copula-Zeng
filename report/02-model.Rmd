---
title: "开题报告"
author: "Li"
date: '2019-04-15'
output: pdf_document
css: ./style/markdown.css
bibliography: Bibfile.bib
eqnPrefixTemplate: ($$i$$)
link-citations: true
linkReferences: true
notice: '@*'
csl: ./style/chinese-gb7714-2005-numeric.csl
autoEqnLabels: false
---


```{r setup, echo=F}

################# 第 2 章 R 程序代码  ####################


knitr::opts_knit$set(root.dir = getwd())
knitr::opts_chunk$set(echo = FALSE, results = 'hide')
knitr::opts_chunk$set(warning = FALSE, message=FALSE)
```

```{r prepare}
rm(list=ls())
options(digits=4)
options(scipen=100)
graphics.off()
Sys.setlocale("LC_ALL", "Chinese")
```



# 黄金期货市场及价格波动风险研究基础

## 黄金期货市场风险的影响因素

黄金期货市场属于金融资本市场，则意味着在获得投资收益的同时，也存在一定的市场风险。其风险大致
分为市场价格波动风险、市场流动性风险、市场信用风险、市场操作风险和市场法律风险。从而针对不同
的风险种类，也对应着不同的影响因素。

一、市场价格波动风险

市场价格波动风险通常被称为市场风险，是指在黄金期货交易过程中，由于黄金期货价格的大幅波动与其
价值预期值偏差太大而导致的风险。由于2008年我国才推出黄金期货市场，市场机制还不是很完善，价格
变化易受各种因素影响，市场风险是目前中国黄金期货市场中潜在的最大风险。影响黄金期货价格变动的
因素不光在供给需求方面，黄金现货价格的波动，其它金融市场的影响，市场利率以及国际地缘等等也会
给黄金期货价格带来一定的波动风险。

二、流动性风险

市场流动性风险是指由于市场交易量不足或缺少交易的对手方，而导致没有在理想的时点达到预想完成的
交易买卖所带来产生的一系列风险。它的存在使得期货市场的价格发现和套期保值功能无法实现，而且还
会使得市场容易被少数人所操纵和控制，制造市场交易数据失真，并且投机情绪蔓延，严重损害期货市场
的发展。影响因素有存量较少，流动性差、交易品种结构不合理以及监管不到位等诸多因素。因此，要想
使期货市场得到稳定的发展，增加交易的活跃度，就需要扩大市场规模，使得交易过程的参与者们容易找
到合适的交易对手来完成市场交易，从而提高市场效率。

三、市场信用风险

伴随着高风险和高收益的黄金期货市场，就存在着保证金制度，也是为了防范市场信用风险，市场信用风
险是指其所参与交易的某一方因种种原因而不能或不愿履行合约给另一方造成的损失所存在的这种风险，
也被称为市场违约风险。而其风险的损失大小主要是由实际的交易所决定，并且在市场交易实际的交易当
中，参与合约的交易双方都是会由于各种原因而造成有可能违约的。因此需要对期货进行严格的风险管理
，设置比较高比例的市场保证金，相应减少市场的杠杆效应和投机性。

四、市场的操作风险

由于交易制度的不完善或交易系统的漏洞及操作人员的失误等原因所实际造成的一系列损失均被称为市场
的操作风险。同时，交易结算制度的不完善也不可避免的带来市场的操作风险。

五、市场法律风险

市场法律风险指的是在期货交易过程中缺少相应的法律法规来对其交易行为进行有关的规范，并且由于相
关的法律内容和交割详细制度的内容的一系列缺失等一原因所形成一定的损失而造就的风险。因此需要在
法律漏洞未出现时就尽早颁布一些相关的法律制度，我国的监管部门也需要做好对实际的期货市场的约束
和指导工作。

## GAS模型理论基础

### GARCH模型

金融时间序列往往具有显著的波动性聚集特征，传统的线性计量模型并不能很好地描述具有尖峰厚尾特征、
异方差以及非对称性的收益率数据，例如ARCH模型，会由于残差序列的条件异方差函数的长期自相关性使
结果失真，为此Bollerslev在Engle的相关研究上提出了广义条件异方差模型（GARCH）以解决类似问题，
该模型结构如下：

$$\left\{ {\begin{array}{l}
{{y_t} = f\left( {t,{y_{t - 1}},{y_{t - 2}}, \cdots } \right) + {\varepsilon _t}}\\
{{\varepsilon _t} = \sqrt {{h_t}} {e_t}}\\
{{h_t} = \omega  + \sum\limits_{i = 1}^p {{\alpha _i}{\varepsilon ^2_{t - i}}}  + 
\sum\limits_{j = 1}^q {{\beta _j}}{h_{t - j}} }
\end{array}} \right.$$ 

式中， ${y_t}$表示时刻$t$的收益率,$h_t$表示条件方差，${e_t}$是均值为0，方差为1的独立同分布随机变量序列, ${\varepsilon_t}$为第$t$ 期的随机扰动项，$\omega$大于0，$\alpha _i$
和$\beta _j$均大于等于0，且两者之和小于1，这里使系数满足一系列正则性条件是为了保证无条件方差
是正的且有限，同时条件方差是随时间变化的。第一个方程为均值方程，用来描述收益率序列条件均值的
变化过程；第二个方程为随机扰动序列，即标准残差序列，考虑到金融时间序列具有尖峰厚尾性和波动聚
集性，通常假标准化残差的边缘分布服从标准正态分布、标准学生t分布和广义误差分布GED以及各自偏态
；第三个方程为方差方程，用来描述收益率序列条件方差的变化过程[@Babatunde2019]。

但GARCH模型不能反映信息冲击的非对称性，从而EGARCH、TGARCH、GJR-GARCH等如雨后春笋般孕育而生。
这里仅介绍EGARCH模型，因为本文所讨论的GAS模型的特例为Beta-t-EGARCH模型。指数GARCH模型，可以
体现正的和负的资产收益率的非对称效应，以更准确的刻画收益率的波动性。EGARCH(p,q)模型由Nelson
提出，考虑了波动的不对称性，即杠杆效应，一般表现为过去的负面信息对条件波动率的影响大于相同规
模的正面信息，其表达式如下：

$$\ln ({h_t}) = \omega  + \sum\limits_{j = 1}^q {{\beta _j}\ln ({h_{t - j}}) + \sum\limits_{i = 1}^p {{\alpha _i}} } \left| {\frac{{{\varepsilon _{t - i}}}}{{\sqrt {{h_{t - i}}} }} - E(\frac{{{\varepsilon _{t - i}}}}{{\sqrt {{h_{t - i}}} }})} \right| + \sum\limits_{k = 1}^r {{\gamma _k}} \frac{{{\varepsilon _{t - k}}}}{{\sqrt {{h_{t - k}}} }}$$
当${\gamma _k} = 0$,说明收益的正冲击将与收益的负冲击对外汇市场的影响相同；当$-1<{\gamma _k}<0$,
说明收益的正冲击对市场波动性的影响小于收益的负冲击对市场波动性的影响；当${\gamma _k} <-1$,
说明收益的正冲击将减少市场的波动性,而收益的负冲击将增加市场的波动性；如果${\gamma _k}>0$,
说明收益的正冲击对市场波动性的影响大于收益的负冲击对市场波动性的影响[@郭楠2009]。


### GAS类模型

在许多涉及对金融或经济变量的时间序列模型进行估计的实际应用中，模型参数是随时间变化的，以便提
供对数据序列的有效描述。由于不可观测性，作为波动代理变量的方差可以看作时变参数。Cox(1981)把带
有时变参数的时间序列分为两类：观测值驱动模型和参数驱动模型。在观测值驱动模型中，参数的时变性
是由使得参数成为滞后因变量的函数所引入的，同时也含有滞后外生变量，即将$t$期的参数值表示为自回
归项和$t-1$期变量可测函数的和，即当前参数值是滞后因变量以及同期和滞后外生变量的确定性函数。尽
管参数是随机的，它们完全是由过去信息所预测的。该方法简化了似然估计，也解释了为什么观测值驱动模
型在统计和经济领域如此受欢迎。这些模型的典型例子包括GARCH、泊松计数模型、自回归条件持续期(ACD)
和自回归条件密度(ACI)模型，以及时变Copula模型等。

但长期以来，观测值驱动模型没有出现一种统一的建模框架，发展出的大多数模型都没有考虑分布的信息，
不随分布的变化而变化。而GAS为采用观测变量密度函数关于时变参数得分函数形成的鞅差序列构造时变
参数模型，为观测值驱动模型提供了一种统一的建模框架。GAS理论的提出使得观测值驱动模型的建立有
了系统化、理论化的指导，发展出的模型充分利用了分布的信息，时变参数演化方程会随分布的变化而变
化。由GAS模型推导出的时变参数模型非常灵活，形式多样，具有广阔的应用前景。而参数驱动模型则用
一阶自回归模型描述参数的动态变化，参数是带有内部误差源的随机过程，该误差源会更新每个时变参数
的动态方程[@Blazsek2019]。常用的参数驱动模型涵盖随机波动模型(SV)和随机密度模型(SI)等。由于参
数驱动模型包含隐变量需要采用数值积分计算似然函数，参数驱动模型估计中的计算耗时，其计算量远远
大于观测驱动模型，在实践应用中往往受到限制。

精确测量金融市场收益的概率分布，更确切地说，精确测量波动性，是从业者对有效管理金融投资组合的重
要关注。当包含规模和形状参数的概率分布被用来建模金融收益时，这两个参数都会影响波动性。在经典金
融时间序列模型中，如ARCH(Engle,1982)和GARCH(Bollerslev1986,1987)，尺度参数是动态的，形状参数是
随时间变化的常数。而在本文中，我们引入新的动态条件得分GAS模型对于条件波动率的测量，其中尺度参
数和形状参数都是动态的[@Blazsek2017a]。而且GAS模型中未知参数的估计可以基于标准似然推理，不需要
计算密度函数或基于模拟的方法。

相对而言，GAS模型服从大范围动态条件分数模型的渐近分布理论，对于证明其可行性至关重要。而且可
以清楚的得到信息矩阵，极大似然估计的渐近正态性证明也相对简单。这与大多数其他情况下的非线性动
态模型形成了对比。例如，最常用的GARCH模型没有明确的信息矩阵，而EGARCH模型几乎没有ML估计的渐
近理论[@Ayala2019]。下面为GAS模型表达式：

$$\left\{ \begin{array}{l}
{y_t}|{y_{t - 1}} \sim p({y_t}|{f_t},{F_t};\theta )\\
{f_{t + 1}} = \omega  + \sum\limits_{i = 1}^p {{\alpha _i}{s_{t - i + 1}} + \sum\limits_{j = 1}^q {{\beta _j}{f_{t - j + 1}}} } \\
{s_t} = {S_t}{\nabla _t}\\
{\nabla _t} = \frac{{\partial \ln p({y_t}|{f_t},{F_t};\theta )}}{{\partial {f_t}}}\\
{S_t} = I_{t|t - 1}^{ - \gamma }\\
{I_{t|t - 1}} = {E_{t - 1}}[{\nabla _t}{\nabla _t}^\prime ]
\end{array} \right.$$

其中资产收益率${y_t} = {\mu_t}+{z_t}={\mu_t}+{\sigma_t}{\varepsilon_t}$，其中${\mu_t}$是${y_t}$的期
望，${\sigma _t}$是条件标准差，${\varepsilon_t}$可服从正态分布、学生-t分布、GED分布或者各自的偏态，
${y_t}$的密度函数为 ${y_t}|{y_{t - 1}} \sim p({y_t}|{f_t};\theta)$，其中${f_t}$为时变参数，${F_t}$为t时刻可用的信息集，包括滞后观测值
$({y_{t -1}},...,{y_1})$和过去时变参数$({f_{t-1}},...,{f_1})$，${\theta}$为不随时间变化的静态
参数，常数$\omega$、系数矩阵${\alpha _i}$和${\beta_j}$都由静态参数${\theta}$确定，即$\omega  = \omega (\theta )$，${\alpha _i} = {\alpha _i}(\theta )$，${\beta _j} = {\beta _j}(\theta )$，
${\nabla _t}$为${f_t}$的得分函数，即密度函数${y_t}$对${f_t}$的梯度；${I_t}$为${f_t}$的Fisher信
息矩阵，通常不具有封闭形式，需要通过模拟和计算得出，${S_t}$通过Fisher信息矩阵构造，用于对得分
进行调整，并结合自回归项${f_{t+1}}$，计算最终的条件密度函数得分${s_t}$，即驱动机制，其中$\gamma$
通常取0、1/2、1，当$\gamma$取0时，${s_t}={\nabla_t}$，这就是GAS模型所特有的驱动机制。

将$s_t$作为时变参数$f_t$演化方程的驱动因子具有明显的优势，因为$s_t$依赖于完整的概率密度函数，
而不仅仅和GARCH类模型一样依赖于观察值的一阶矩和二阶矩。关于时变参数（均值、方差、形状参数）的
每个动态方程均由对数似然（LLK）的条件得分$s_t$对其进行驱动，每个时变参数均可表示成上式中第二个
递归式的形式。此外，条件得分分配给极端收益的权重一般要低于非极端收益的权重，也就是说，该模型对极
端观测值具有稳健性[@Blazsek2019]，这类模型可以有效控制了回报分布的极端观察。

另外，${S_t}$是对数观测密度得分的缩放函数，用于对得分进行尺度调整，${S_t}$的存在使得GAS模型
具有额外的灵活性。GAS模型的关键新颖之处是使用缩放分数来驱动参数${f_t}$的变化，将条件观测密度的
形状直接与${f_t}$本身动态变化相联系。例如，如果${p}$是正态分布密度函数，${f_t}=\sigma_t^2$为方差，
然后通过一定的缩放比例选择，令${S_t}=I_{t|t-1}^{-1}$，相应的GAS（1，1）模型可以表示为：

${f_{t + 1}} = w + {\alpha _1}(y_t^2 - {f_t}) + {\beta _1}{f_t}$

这与标准GARCH（1，1）模型等价:

${f_{t + 1}} = w + {\alpha _1}y_t^2 + {\beta _1}{f_t}$

但是，当${\varepsilon_t}$服从零均值，方差为1，自由度为v的t分布时，GAS(1,1)模型为：

${f_{t + 1}} = \omega  + \alpha (\frac{{v + 3}}{v})[{(1 + \frac{{z_t^2}}{{(v - 2){f_t}}})^{ - 1}}(\frac{{v + 1}}{{v - 2}})z_t^2 - {f_t}] + \beta {f_t}$

此时GAS(1，1)的递归式与GARCH（1，1）-t模型有显著的不同，此时称为GAS的另一个特例：GAS-GARCH-t，
由于上式中的第二项在自由度v恒定时，大样本下的$\left|{{z_t}}\right|$方差增长平缓，但t分布的尾部
特性使得方差不会有一个很大的增长，对于${y_t}$中的极端值，序列不会产生剧烈波动。

GAS模型的一个优良特性就是给出过去的信息和随机参数向$\Theta=(\omega,\alpha,\beta)$，可以准确地
估计出时变参数向量$f_t$，将${y_{1:T}}$记为$y_t$中的样本$T$，GAS模型的参数向量$\Theta$可由
下式进行极大似然估计：

$$\hat \Theta  \equiv \arg \mathop {\max }\limits_\Theta  L(\Theta ;{y_{1:T}})$$
其中，$L(\Theta ;{y_{1:T}}) = \log p({y_1};{f_1}) + \sum\limits_{t = 2}^T {\log p({y_t};{f_T})}$，
当$t=1$时，${f_1} = {(I - \beta)^{ - 1}}\omega$；当$t>1$时，${f_1} = f({y_{1:t - 1}};\Theta )$。

在进行极大似然估计中需要注意，当估计值具有相合性和渐进正态性时，式中对数函数的极大值是变化的，这是
由于$\Lambda (·)$的非线性和$f_t$进入得分$S_t$中的方式不同所造成的。因此，模型的最优解是基于梯度的、
初始值的。在R语言中，通过对系数矩阵${\alpha _i}$、${\beta _i}$进行网格搜索来确定初始值。

GAS模型可以为时变参数建模提供一个统一的框架，波动模型设定包括收益模型（也称为一阶矩模型）
设定和波动模型（也称为二阶矩模型）设定，而GAS模型不需要和Nelson(1991)的EGARCH模型那样依赖于
矩，可以通过学生-t分布的尺度直接模拟波动性[@Alanya2017]。为了更深入的研究GARCH与GAS之间的差异，
Alanya（2017）参照Harvey（2013）提出了一个完全基于波动性的分数驱动模型，称为Beta-t-(E)GARCH模型，该
模型基于完全相同的原理，是GAS模型的特例，可进一步证明考虑学生-t分布的GAS模型对于异常值或非典型观测
值的稳健性。Beta-t-EGARCH模型表达式如下：

$$\left\{ {\begin{array}{l}
{{\varepsilon _t} = {e^{\sqrt {{h_{t|t - 1}}} }}{\lambda _t}}\\
{h{}_{t + 1|t} = \omega (I - \beta )^{ - 1} + \beta {h_{t|t - 1}} + \alpha {u_t}}\\
{{u_t} = \frac{{(v + 1)\varepsilon _t^2}}{{v\exp (2{h_{t|t - 1}}) + \varepsilon _t^2}} - 1}\\
{{\lambda _t}\sim t(v)}
\end{array}} \right.$$

${\omega}$是规模/波动过程的无条件均值，而${u_t}$与Beta-t-GARCH中的得分成正比，因此规模和波动
率都直接反映在此模型中，在自由度为v的情况下模型对条件方差有很好的估计，尽管可能导致对方差的
不精确估计。特别的，当v→＋∞时，就退化为Bollerslev（1986）的标准GARCH模型。而GAS模型中是${{\rm{f}}_t}{\rm{ = }}{{\rm{h}}_t}{\rm{ = }}\sigma _t^2$，
${S_t} = I_{t|t - 1}^{ -1}$时，GAS(1,1)即为GARCH(1,1)。GAS模型涵盖了许多以观察值为基础对模型参数进行更新的金融时间序列模型,如自回归条件持续时间(ACD)、自回归
条件强度(ACI)和单一误差源模型。GAS模型利用分布的得分函数来更新时变参数，具有极强的灵活性，许
多众所周知的观测值驱动模型都可以视为它的特例。
 
 
## 风险及回测理论

### 风险理论

风险管理的核心是风险度量，运用概率论和数现统计的方法对过去损失资料进行分析，对风险事故
的发生概率和风险事故发生后可能造成的损失的严重程度进行定量的分析和预测即为风险度量。准
确度量金融风险，对维护金融系统的稳定和风险管理者较为准确把握损失概率都有一定的作用。即
使随着交易制度以及黄金期货标准合约的不断调整，我国黄金期货市场流动性大幅度加强，但是受
到美元价格、人民币走势、石油价格以及国际突发事件等影响，此市场波动仍然十分剧烈。前面已
经介绍，金融风险包括市场风险、信用风险和流动性风险等[@Lin2017]，在黄金期货市场中投资者
做出决策时需要关注的风险主要是市场风险因此本文研究的是我国黄金期货的市场风险测度问题。
在各种风险度量的方法中，从只能描述收益与期望值的偏移程度的方差、下半方差发展到现代的在
险价值(VAR)、条件在险价值(CVAR)和预期损失(ES)。

1993年摩根大通公司开始使用VaR（即在险价值）模型来度量公司内部存在的金融风险，后来在巴
塞尔银行监察管理委员会的推动下，该模型广泛地应用于世界主要金融机构,该模型对黄金期货市场
中存在风险的测量与预警都有很大的帮助。VAR方法将金融资产或金融投资组合所带来的一系列风险
最后概括为一个具体的数字来表示未来一定的时期内在某一确定风险承受能力（或称“置信水平”、
“置信度”、“可靠度”）下的可能遭受的最大损失。其表达式为：
$$\Pr ob(\Delta p > VaR) = 1 - \alpha$$
其中$$\Delta p = P(t + \Delta t) - P(t)$$
表示资产在特定期限内的最大可能损失，$\alpha$为置信度（也称可靠度或置信水平），该参数体现了参
与者风险承受能力的大小。当置信水平比较大时，参与者风险承受能力越弱，越厌恶风险，在该置信水平
下计算出来的VaR值也就越大。一般为90%或95%或99%，VaR表示在置信度$\alpha$下的在险资产价值。

由式可以发现，置信度$\alpha$越大，VaR值也会越大。例如某种金融资产在其他条件不变的情况，
其在99%置信水平下的VaR值肯定会大于其在95%置信水平下的VaR值。一般而言，置信度越高说明投资者
的风险偏好越小，而置信度越低说明投资者比较偏好风险。不同参与者对风险承受能力不同，那么在进行 
VaR测算前所选取的可靠度也是不同的，比如JPMorgan选取95%置信水平；而花旗银行选择95.4%的置信水
平。另外，置信度的选择与数据的充分性也有关，越高的置信度意味准确的概率越高。

除此之外，VaR也受特定时段长短影响，也可以称为持有期长短。持有期限是指所取样本的频率，通常选
择一个月或者一天。由于波动性和时间长短呈正向关系，因此持有期限选择越长，则波动性越大，则测算
出来的VaR值也就越大。

它其实也是属于一种AR模型的推广，并且它还是会被经常用到的一种计量经济模型，简称VAR模型。
使用模型中所有的当期变量与变量若干滞后的变量之间并且进行的回归运算就是该模型的原理，例如
某公司年报显示1994年一天的95%VaR值为1500万美元，表明有95%的可能在该吋间点发生的损失额小于
1500万実元，超过1500万美元的不超过给定的显著性水平5%，也就是说100次这样的情况大概有5次损失
程度大于1500万美元。

尽管VaR方法已成为测度金融市场风险最普遍的方法，但也存在诸多问题：首先，VaR方法只能得出损
失超过VaR值的概率，而无法提供投资组合损失分布尾部信息的具体信息。然而尾部信息的非充分性，
就造成无法考察投资组合的左尾损失，就有可能给金融监管部门以及投资者带来无法承受的风险。其
次。VaR方法需要满足金融投资组合收益率时间序列服从正态分布，否则不太准确，没有考虑时间序
列存在的“尖峰厚尾”特性，不满足风险测度一致性的标准。而且，VaR不具有次可加性，破坏了风险
分散化原理，投资组合的风险有可能大于投资组合中各项资产风险之和，而且这增加了金融机构对总
体风险进行有效管理的难度。

Artzner、Dellbaen等于1999年提出金融资产风险度量模型必须具有一致性，即风险度量方法必须满足
次可加性、正齐次性、转移不变性和单调性。因此，条件风险价值(CVaR)和预期损失(ES)应运而生。ES就
是用来度量一定风险水平下那些最糟糕的巨额损失的平均值的。VaR忽略了尾部风险，而ES可以更准确地
刻画风险。随后，Acerbi和Tasche证明了分布函数连续的情况下CVaR和ES是等价的，都是一致性风险测度
工具。当分布函数不连续时，CVaR不再是一致性风险测度，因此ES具有更广的应用范围，CVaR是ES的特殊
形式。Inui和Kijima证明了任何一致风险测度都是ES的凸组合，ES是一致性风险度量工具，并且ES在所有
的一致性风险测度中是最优的，对于极端风险的估计更为充分，对实际损失的覆盖程度更高[@Fissler2016]。
因此，考虑到VaR的广泛应用性和不足，有必要将VaR和ES结合使用来度量我国黄金期货市场的风险。

Expected Shortfall的数学定义如下：
设X为定义在概率空间上$(\Omega ,\Sigma ,p)$且表示某种资产或者某个投资组合收益分
布的随机变量,用$E(X)$表示概率$p$的数学期望，则当$\alpha  \in (0,1)$，$X$在置信水平为
$1 - \alpha$时的期望损失为：
$$E{S_\alpha } = E{S_\alpha }(X) =  - \frac{1}{\alpha }\{ E[X{I_{\left[ {x \le q\alpha (X)} \right]}}] + {q_\alpha }(X)(\alpha  - P[X \le {q_\alpha }(X)])\}$$
其中，$${q_\alpha }(X) = \inf \{ X \in R:P[X \le x] \ge \alpha \}$$，是$X$的下分位数。
在实际计算中，ES 有如下的定义：
$$E{S_\alpha } = E{S_\alpha }(X) =  - \frac{1}{a}\int_{ - \infty }^{ - VaR} {xf(x)dx}$$
ES 还可以表示成与VaR相关的形式：
$$E{S_\alpha } = E[X{\left| {X > Va{R_\alpha }] = Va{R_\alpha } + E[X - VaR} \right._\alpha }\left| {X > Va{R_\alpha }]} \right.$$
即ES值实际上实在VaR 的基础上加上损失高于VaR时的期望损失。

### 回测检验

VaR方法准确性检验是指由VaR方法获得的结果对实际遭受损失情况的覆盖程度。例如：95%置信水平下
的VaR，那么该模型准确性代表：损失的实际结果是否在小于百分之五的概率下超过计算出的VaR值。
此检验有多样方法，本文采取由Kupiec于1996年给出的失败率检验法，该方法为当前最为通用方法。此
方法将失败观察的二项结果看作一系列伯努利实验，假定每次观测都是相互独立的，将金融资产所观测
到的实际损失与VaR值比对，当实际损失小于VaR时记为成功，当实际损失超过VaR时记为失败。

模型准确的最直接检验方法是考察实际损失超过的概率。把实际损失超过的估计记为失败，把实际损失
低于的估计记为成功。如果假定估计具有时间上的独立性，则通过观察失败情况下得出的二项式结果则
表示为独立的伯努利实验，其中失败的期望概率值为p。例如，若置信度为99%，那么对应实验的失败概
率应为1%。因此，实际上是通过检验失败概率是否等于特定概率来验证模型的恰当性。

假定总天数为T天，理论失败率为p，则失败频数服从二项分布 $B(T,p)$ 。若真实失败天数为x天，
则真实失败率为 $\widehat p=x/T$ 。设原假设为 ${H_0}:P = {P_0}$ ，备择假设为 ${H_1}:P \ne {P_0}$，
构造检验统计量以验证失败率是否拒绝原假设，若不拒绝原假设，表明模型预测准确，反之则表明模型失
真，不能准确度量原序列的风险程度。Kupiec(1995)提出构造似然比方程来对假设进行检验的方式
[@kupiec1995]。似然比方程为：

$$LR_{POF} =  - 2\ln \left( {\frac{{{{\left( {1 - p} \right)}^{T - x}}{p^x}}}{{{{\left[ {1 - \left( {\frac{x}{T}} \right)} \right]}^{T - x}}{{\left( {\frac{x}{T}} \right)}^x}}}} \right)$$

式在原假设成立的情况下，检验统计量 $LR_{POF}$ 服从自由度为1的 ${\chi ^2}$ 分布。

由于Kupiec检验只关注失败的次数，相当于该方法默认风险事件会随着时间的推移而均匀发生。但是在现
实情况中，往往快速连续发生的巨大损失更有可能导致灾难性事件的发生。而且Kupiec检验只在大样本的
情况下较为有效，在小样本下，将可能出现被低估的潜在损失的情况。此外，当p值较小时，其相对应的
概率也比较小，将难以发现可能存在的偏差，因此在Kupiec中一般选择比较大的p值。

为了弥补Kupiec的不足，Christoffersen(1998)提出了条件覆盖测试检验方法[@Christoffersen1998]。该
检验方式首先指定两种状态，当实际收益率超过VaR时为状态1，反之为状态0。然后设$n_{ij}$表示由状
态i发生到状态j发生所间隔的天数，$\pi _i$表示当前一个状态为i时，当前状态为1的概率，即：

$${\pi _0} = \frac{{{n_{01}}}}{{{n_{00}} + {n_{01}}}},{\pi _1} = \frac{{{n_{11}}}}{{{n_{10}} + {n_{11}}}}\;\;\;and\;\;{\pi} = \frac{{{n_{01}} + {n_{11}}}}{{{n_{00}} + {n_{01}} + {n_{10}} + {n_{11}}}}$$
此时可构造新的似然比函数 $LR_{ind}$：

$$L{R_{ind}} =  - 2\ln \left( {\frac{{{{\left( {1 - \pi } \right)}^{{n_{00}} + {n_{10}}}}{\pi ^{{n_{01}} + {n_{11}}}}}}{{{{\left( {1 - {\pi _0}} \right)}^{{n_{00}}}}{\pi _0}^{{n_{01}}}{{\left( {1 - {\pi _1}} \right)}^{{n_{10}}}}{\pi _1}^{{n_{11}}}}}} \right)$$
将该似然比函数 $LR_{ind}$ 与Kupiec检验的似然比函数结合，即

$$LR_{cc}=LR_{POF}+LR_{ind}$$
新的检验统计量 $LR_{cc}$ 不仅可以检验模型的准确率，还可以检验实际收益率超过VaR的情况是
否独立，即条件覆盖性。 $LR_{cc}$ 在原假设成立的情况下服从自由度为2的 ${\chi ^2}$ 分布。

为了使模型预测更加准确，Engle和Manganelli(2004)提出了还可以检验不同置信水平下模型预测效果的
动态分位数测试[@engle2004]。

设 $H_t=I(r_t<VaR_t)$ 对于 $F_{t-1}$ ，假定有

$$E\left( {{H_t}\left| {{F_{t - 1}}} \right.} \right) = \lambda $$

式中，对 $i \in {F_{t - 1}}$ ，任何 $\omega _{t-1}$ 都与 $H_t$ 不相关。Engle
和Manganelli认为VaR的条件超越非常重要，因此，令 $\left\{ {Va{R_t}} \right\}_{t = 1}^T$ 为
一个独立同分布的随机变量序列，则有：

$$Va{R_t} = \left\{ {\begin{array}{*{20}{cc}}
K&{p = 1 - \lambda }\\
{ - K}&{p = \lambda }
\end{array}} \right.$$

式中K对 $VaR_t$ 也施加了一个限制条件，超出序列就表现为一个正确的条件覆盖。为了有效
的测试[@eq:DQ2]式，对于在 $F_{t-1}$ 中的解释变量可以回归 $H_t$ ，建立如下方程：

$${H_t} = {\lambda _0} + \sum\limits_{i = 1}^p {{\beta _i}{H_{t - i}}}  + {\beta _{p + 1}}\widehat {Va{R_t}} + \sum\limits_{j = 1}^n {{\beta _{p + j + 1}}f\left( {{\omega _{t - 1}},j} \right)}  + {u_t}$$
 
对于式，建立检验假设， $\lambda_0=\lambda$ 和 $\beta_i=0,i=1,\ldots,n+p+1$ 。
采用向量则可以为：

$$H - \lambda v = X\beta  + u,\;\;\;{u_t} = \left\{ {\begin{array}{*{20}{cc}}
{ - \lambda }&{p = 1 - \lambda }\\
\lambda &{p = \lambda }
\end{array}} \right.$$

式中 $\beta=\lambda_0-\lambda$，$v$是一个单位矩阵。在原假设的基础上回归方程没有解释作用，比如在原假
设 $\beta=0$ 的情况下，虽然回归方程与在原假设下的因变量不具有相关性，但可以建立CLT形式：

$$\widehat {{\beta _{LS}}} = {\left( {X'X} \right)^{ - 1}}X'\left( {H - \lambda v} \right)\mathop  \sim \limits^{asy} N\left[ {0,{{\left( {X'X} \right)}^{ - 1}}\lambda \left( {1 - \lambda } \right)} \right]$$

从式中，便可提出动态分位数测试的测试统计量：

$$DQ = \frac{{{{\widehat {{\beta _{LS}}}}^\prime }X'X\widehat {{\beta _{LS}}}}}{{\lambda \left( {1 - \lambda } \right)}}\mathop  \sim \limits^{asy} \chi _{p + n + 2}^2$$
此外，使用模型比较技术来选择性能最好的模型也可通过分位数损失(QL)来确定最优模型的排序，在形式
上，给定时间$t$的风险水平为$\alpha$的VaR预测，相关分位数损失定义为:

$$Q{L_t}(\alpha ) \equiv (\alpha  - {d_t})({r _t} - Va{R_t}(\alpha ))$$

QL是一种不对称的损失函数，给予那些违反VaR水平的更高的权重。分位数损失在预测期内取平均值，平
均值较低的模型是首选。最后评估模型A与模型B的性能优劣，考察两个模型的平均QLs之比，即如果
$QLA/QLB <1$，则模型A优于模型B，反之亦然。

但对于ES而言，没有可用的损失函数来度量风险，Fissler和Ziegel(2016)[@Fissler2016]最近的研究表
明，这对组合(VaR, ES)是可以通过FZ损失函数共同引出的，令$G1(x)=0,G2(x)=−1/x$，假设VaR和ES的值
严格为负，在条件分布为常数的情况下，则给定时间$t$的风险水平为$\alpha$的VaR和ES的联合损失函数(joint 
loss function,FZL)定义如下：

$$FZL_t^\varepsilon  \equiv \frac{1}{{\alpha ES_t^\alpha }}{d_t}({r_t} - VaR_t^\alpha ) + \frac{{VaR_t^\alpha }}{{ES_t^\alpha }} + \log ( - ES_t^\alpha ) - 1$$
其中，$ES_t^\alpha  \le VaR_t^\alpha  < 0$，对于QL,FZ损失在预测期间取平均值，平均值较低的模型为佳。

这里，也介绍一下GAS框架下常用的另外一种模型排序中的评分规则：平均负日志分数(The average negative log score，NLS)，
其指定了负的日志分数，评分规则之间的“方向”是相同的，即NLS越低，预测越好。定义式如下：

$$\overline {NLS}  \equiv  - \frac{1}{H}\sum\limits_{t = T}^{T + H - 1} {\log p({y_{t + 1}};\widehat {{\theta _{t + 1}}})} $$


<!-- # 参考文献 {-} -->
<!--[//]: # (\bibliography{Bibfile})-->
	
